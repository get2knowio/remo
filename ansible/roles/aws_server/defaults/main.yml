---
# AWS Server Role Defaults

# Resource naming - namespaced by user for multi-user support
aws_resource_name: "{{ lookup('env', 'USER') | default('remo', true) }}"

# Derived resource names
aws_key_name: "remo-{{ aws_resource_name }}-key"
aws_security_group_name: "remo-{{ aws_resource_name }}-sg"
aws_efs_name: "remo-{{ aws_resource_name }}-home"
aws_instance_name: "remo-{{ aws_resource_name }}"

# AWS credentials and region
# For SSO: set AWS_PROFILE env var or pass -e aws_profile=<profile-name>
# For explicit credentials: set AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY
aws_profile: "{{ lookup('env', 'AWS_PROFILE') | default('', true) }}"
aws_access_key_id: "{{ lookup('env', 'AWS_ACCESS_KEY_ID') | default('', true) }}"
aws_secret_access_key: "{{ lookup('env', 'AWS_SECRET_ACCESS_KEY') | default('', true) }}"
aws_region: "{{ lookup('env', 'AWS_REGION') | default('us-west-2', true) }}"

# Instance configuration
aws_instance_type: "t3.medium"  # 2 vCPU, 4GB RAM - good for dev
aws_use_spot: false
aws_spot_max_price: ""  # Empty means on-demand price

# AMI configuration - Ubuntu 24.04 LTS
aws_ami_owner: "099720109477"  # Canonical's AWS account
aws_ami_name_pattern: "ubuntu/images/hvm-ssd-gp3/ubuntu-noble-24.04-amd64-server-*"

# SSH configuration
aws_ssh_public_key_path: "~/.ssh/id_rsa.pub"
aws_ssh_private_key_path: "~/.ssh/id_rsa"

# Security group - SSH allowed CIDR (auto-detected if empty)
aws_allowed_ssh_cidr: ""

# Storage configuration - EBS (block storage) or EFS (network filesystem)
# EBS is simpler and faster for single-instance use
# EFS allows sharing across instances but has DNS/mounting complexity
aws_storage_type: "ebs"  # "ebs" or "efs"

# EBS configuration (used when aws_storage_type is "ebs")
aws_ebs_name: "remo-{{ aws_resource_name }}-home"
aws_ebs_size: 50  # Size in GB
aws_ebs_type: "gp3"  # gp3 is the best general-purpose option
aws_ebs_device_name: "/dev/xvdf"  # Device name when attached

# EFS configuration (used when aws_storage_type is "efs")
aws_create_efs: false  # Deprecated: use aws_storage_type instead
aws_efs_lifecycle_policy: "AFTER_7_DAYS"  # Move to IA after 7 days
aws_efs_throughput_mode: "bursting"  # bursting or provisioned

# Route53 configuration (optional)
aws_create_dns: false
aws_route53_zone_id: "{{ lookup('env', 'AWS_ROUTE53_ZONE_ID') | default('', true) }}"
aws_route53_zone_domain: "{{ lookup('env', 'AWS_ROUTE53_ZONE_DOMAIN') | default('', true) }}"
aws_route53_record_name: "{{ aws_resource_name }}"  # Creates <name>.<domain>

# Elastic IP
aws_create_eip: true

# Access mode: 'direct' (SSH over internet) or 'ssm' (AWS SSM Session Manager)
aws_access_mode: "direct"

# IAM instance profile name (required when aws_access_mode is 'ssm')
aws_iam_instance_profile: ""

# Whether remo created the IAM role/profile (used by teardown to decide cleanup)
aws_iam_created: "false"
