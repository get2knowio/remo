---
# incus_bootstrap default variables
# This file defines all default configuration for the Incus bootstrap role
# Ansible best practice: All variables that can be overridden should be in defaults/main.yml

# ============================================================================
# MULTI-DISTRIBUTION SUPPORT
# ============================================================================

# List of supported OS families
# Currently only OpenSUSE Tumbleweed (Suse family) is tested and supported
# To add support for additional distributions:
#   1. Add the OS family to this list (e.g., 'Debian' for Ubuntu)
#   2. Add distribution-specific package installation tasks in tasks/main.yml
#   3. Verify service unit names match the distribution's defaults
#   4. Test initialization on the target distribution
#
# Planned support: Ubuntu (Debian family), Fedora (RedHat family)
incus_supported_os_families:
  - "Suse"  # OpenSUSE Tumbleweed, OpenSUSE Leap

# Extension points for new distributions:
#
# PACKAGE NAMES:
#   OpenSUSE (current): 'incus' and 'incus-tools'
#   Ubuntu/Debian: May require Zabbly PPA or official Incus repository
#                  https://github.com/zabbly/incus
#   Fedora/RHEL: May require COPR repository or manual installation
#                Package names may differ from OpenSUSE
#
# PACKAGE MANAGER TASKS:
#   OpenSUSE: community.general.zypper module (see the OpenSUSE package installation task in tasks/main.yml)
#   Ubuntu/Debian: ansible.builtin.apt module
#                  Example: Add apt repository, update cache, install packages
#   Fedora/RHEL: ansible.builtin.dnf or ansible.builtin.yum module
#                Example: Add repository, install packages
#
# SERVICE UNIT NAMES:
#   Generally consistent across distributions:
#     - incus.socket (system socket unit)
#     - incus-user.socket (user delegation socket)
#     - incusd.service (main daemon service)
#   However, always verify service names match on the target distribution
#   by checking systemd unit files after package installation
#
# OS-SPECIFIC INITIALIZATION:
#   Some distributions may require additional setup:
#     - Kernel module loading (overlay, br_netfilter)
#     - Firewall configuration (firewalld on RHEL/Fedora, ufw on Ubuntu)
#     - SELinux policy adjustments (RHEL/Fedora)
#     - AppArmor profile adjustments (Ubuntu/Debian)
#
# IMPLEMENTATION EXAMPLE (Ubuntu support):
#   In tasks/main.yml, add after the OpenSUSE package installation block:
#
#   - name: Add Zabbly Incus repository for Ubuntu
#     ansible.builtin.apt_repository:
#       repo: ppa:zabbly/incus
#       state: present
#     when: ansible_os_family == 'Debian'
#
#   - name: Install Incus packages on Ubuntu/Debian
#     ansible.builtin.apt:
#       name:
#         - incus
#         - incus-tools
#       state: present
#       update_cache: true
#     when: ansible_os_family == 'Debian'
#
# See the placeholder comment in tasks/main.yml (line ~155) for where to add
# distribution-specific package installation tasks.

# ============================================================================
# STORAGE POOL AND NETWORK CONFIGURATION
# ============================================================================
# NOTE: When using 'incus admin init --minimal', Incus automatically creates:
#   - Storage pool: "default" (directory-based, works on any filesystem)
#   - Network bridge: "incusbr0" (with automatic NAT and DHCP)
#   - Default profile: configured with both storage and network devices
#
# These defaults provide immediate container functionality without manual
# configuration. For advanced storage backends (ZFS, Btrfs, LVM) or custom
# network configurations, you can manually configure Incus after bootstrap
# or set incus_skip_init=true and handle initialization separately.
#
# The minimal initialization approach prioritizes:
#   - Simplicity: One command does all basic setup
#   - Compatibility: Directory storage works everywhere
#   - Idempotency: Safe to run multiple times (checks before initializing)

# Storage pool name created during initialization
# INFORMATIONAL ONLY: This documents what 'incus admin init --minimal' creates.
# The minimal initialization always creates a pool named "default".
# To use a custom name, set incus_skip_init=true and configure manually.
incus_storage_pool_name: "default"

# Storage backend driver used by the default pool
# INFORMATIONAL ONLY: Documents what 'incus admin init --minimal' creates.
# The minimal initialization always uses directory-based storage ("dir").
# This driver works on any filesystem without special requirements (no ZFS, Btrfs, or LVM needed).
# To use advanced storage backends (zfs, btrfs, lvm), set incus_skip_init=true
# and create storage pools manually after bootstrap.
incus_storage_pool_driver: "dir"

# Network bridge name created during initialization
# INFORMATIONAL ONLY: This documents what 'incus admin init --minimal' creates.
# The minimal initialization always creates a bridge named "incusbr0" with auto-configured NAT.
# To use a custom network name or configuration, set incus_skip_init=true and configure manually.
incus_network_name: "incusbr0"

# IPv4 address configuration for the network bridge
# INFORMATIONAL ONLY: Documents what 'incus admin init --minimal' creates.
# The minimal initialization auto-configures IPv4 with a random subnet (typically 10.x.x.1/24)
# and enables NAT for container internet access. The actual subnet is chosen automatically
# to avoid conflicts with existing networks.
# To specify a custom IPv4 CIDR (e.g., "10.10.10.1/24"), set incus_skip_init=true
# and create the network manually with 'incus network create'.
incus_network_ipv4: "auto"

# IPv6 address configuration for the network bridge
# INFORMATIONAL ONLY: Documents what 'incus admin init --minimal' creates.
# Default is "none" to disable IPv6 for security reasons (reduces attack surface).
# To enable IPv6 with auto-configuration (typically fd42::/64) or use a custom IPv6 CIDR,
# set incus_skip_init=true and create the network manually with 'incus network create'.
incus_network_ipv6: "none"

# ============================================================================
# USER PERMISSIONS CONFIGURATION
# ============================================================================

# User to add to the incus-admin group for non-root container management
# Defaults to the user running Ansible (typically the current logged-in user)
incus_user: "{{ ansible_user_id }}"

# ============================================================================
# BEHAVIORAL FLAGS
# ============================================================================

# Skip Incus initialization (storage pool and network creation)
# Set to true to install and configure services only, without initializing storage/network
incus_skip_init: false

# Enable incus-user.socket for unprivileged container delegation
# This allows users to run containers in unprivileged mode
incus_enable_user_socket: true

# Control verbosity of verification output
# Options:
#   - "summary": Show only task names and pass/fail status (recommended for normal use)
#   - "detailed": Show full YAML output from verification commands (useful for debugging)
# This affects the post-bootstrap verification tasks that check Incus installation
incus_bootstrap_verbosity: "summary"

# ============================================================================
# SERVICE NAMES AND PACKAGES
# ============================================================================

# Primary Incus package(s) to install
# Package name varies by distribution (handled by distribution-specific tasks)
# These are descriptive - actual package names are distribution-specific

# Incus system daemon socket unit
incus_system_socket_unit: "incus.socket"

# Incus user socket unit for unprivileged delegation
incus_user_socket_unit: "incus-user.socket"

# Incus system service unit (activated by socket)
incus_system_service_unit: "incusd.service"

# ============================================================================
# USER GROUP CONFIGURATION
# ============================================================================

# System group for granting Incus daemon access permissions
# Members can manage Incus containers without requiring sudo
incus_admin_group: "incus-admin"

# ============================================================================
# DOCUMENTATION AND SUPPORT URLS
# ============================================================================

# Official Incus documentation URL
# Used in error messages and verification summaries to guide users to official docs
incus_documentation_url: "https://linuxcontainers.org/incus/docs/"

# Project issue tracker URL
# Used in error messages to guide users to report issues or request features
project_issues_url: "https://github.com/get2knowio/remo/issues"
